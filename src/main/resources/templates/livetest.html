<!DOCTYPE html>
<html lang="ko" 
    xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
    <head>
        <meta charset="UTF-8">
    </head>
    <style>
    	body{
    		position: relative;
    	}
    	
    	#canvasdiv{
    		width: 100%;
    		height: 100%;
    	}
    	
    	#canvas{
    		width: 2000px;
    		height: 800px;
    	}
    
    	#container{
    		width: 2000px;
    		height: 800px;
    		position: absolute;
    	}
    
    	#video, #video2{
    		position: absolute;
    	}
    	
    	#video{
    		top: 0;
    		left: 0;
    		width: 300px;
    		height: 300px;
    	}
    	
    	#video2{
    		top: 0;
    		left: 0;
    		width: 2000px;
    		height: 800px;
    	}
    </style>
    <body>
    	<h1>라이브 테스트</h1>
    	<div id="canvasdiv">
    		<img src="" id="idid">
    		<input type="button" id="bbbutton">
    		 
    	</div>
    	<div id="container">
    		<video id="video2" class="video" autoplay></video>
    		<video id="video" class="video" autoplay></video>
    		<input type="button" id="button" value="Fadsfasd">
    	</div>
    	
    </body>
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script th:inline="javascript">
        	/*<![CDATA[*/
        		var div = document.getElementById('container')
        		var video = document.getElementById('video'); // 캠의 화면이 나올 video 변수
        		var video2 = document.getElementById('video2'); // 모니터의 화면이 나올 video 변수
        		var canvas = document.getElementById('canvas');
        		var button = document.getElementById('bbbutton');
        		var idid = document.getElementById('idid');
        		var error_test = navigator.mediaDevices;
        		
        		
        		button.onclick = function(){
        			/*
        			var context = canvas.getContext('2d');
        			context.drawImage(div, 0, 0, 2000, 800);
        			img.src = canvas.toDataURL("image/png");
        			*/
        			
        			html2canvas(div,{
        				allowTaint: true,
        				useCORS: true,
        				width: div.offsetWidth,
        				height: div.offsetHeight,
        				scale: 1
        			}).then(function(canvas){
        				var imageurl = canvas.toDataURL('image/png');
        				idid.src=imageurl;
        			})
        			
        			
        		}
        		
        		
        		
        		
        		
        		
        		
        		
        		
        		
        		
        		
        		
        		
        		
        		
        		
        		
        		
        		
        		
        		
        		
        		
        		
        		
        		
        		
        		
        		
        		
        		
        		
        		navigator.mediaDevices.enumerateDevices()  // 현재 연결되어있는 장치들의 목록을 가져옴
    			.then(function(devices){
    				devices.forEach(function(device){
    					console.log(device.kind + ' ' + device.label)
    				})
    			})
    		
        			
        		document.getElementById("button").onclick = function(){
        			
        		}
        			
        		if(navigator.mediaDevices.getUserMedia){
        			navigator.mediaDevices.getUserMedia({video: true})
        				.then(function(stream){
        					video.srcObject = stream;
        				})
        				.catch(function(error){ // 처음부터 연결이 안될 시 실행됨
        					video.remove();
        					console.log('캠이 연결이 안되어있음')
        				})
        		}
        		
        		if(navigator.mediaDevices.getDisplayMedia){
        			navigator.mediaDevices.getDisplayMedia({video: true})
        				.then(function(stream){
        					video2.srcObject = stream;
        				})
        				.catch(function(error){ // 처음부터 연결이 안될 시 실행됨
        					video2.remove();
        					console.log('모니터가 연결이 안되어있음')
        				})
        		}
        		
        	/*]]*/
    </script>
</html>